webpackJsonp([9],{0:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}n(352),n(9),n(306),n(333),n(330);var c=n(326),o=a(c),d=n(334),i=a(d),r=n(351),f=a(r),h=$(".koala-message-list-page"),s=h.find("table"),l=h.find(".message-btn-group"),u=h.find(".search-form-grop"),p=h.find("#message_select_form");p.find(".form-control").on("change",function(e){var t=p.serializeObject(),n=i["default"].getQueryObject();t.page=1,t.category=n.category,location.href=i["default"].getQueryString(t)}),s.find("thead .checkbox").on("change",function(e){e.preventDefault(),e.stopPropagation();var t=$(this).prop("checked");$(this).parents("table").find("tbody .checkbox").prop("checked",t),t?(l.fadeIn(300),u.hide()):(l.hide(),u.fadeIn(300))}),s.find("tbody .checkbox").on("change",function(e){e.preventDefault(),e.stopPropagation();var t=!0,n=!1;$(this).parents("table").find("tbody .checkbox").each(function(){$(this).prop("checked")?n=!0:t=!1}),s.find("thead .checkbox").prop("checked",t),n?(l.fadeIn(300),u.hide()):(l.hide(),u.fadeIn(300))}),s.find("tbody tr").on("click",function(e){var t=$(this).data("id");return!!$(e.target).hasClass("checkbox")||void(window.location.href="/messages/"+t)}),h.find("#btn_message_read").on("click",function(){s.find("tbody tr").removeClass("error");var e=[],t=s.find("tbody .checkbox:checked").parents("tr");t.each(function(){var t=parseInt($(this).data("status"));1===t&&e.push($(this).data("id"))});var n=[],a=[],c=e.map(function(e){return new Promise(function(t,c){f["default"].getById(e).then(function(){a.push(e),t()})["catch"](function(){n.push(e),c()})})});Promise.all(c).then(function(){o["default"].alert("批量标记信息成功~").then(function(){t.find(".message-status-label").removeClass("label-danger").addClass("label-success"),t.find(".checkbox:checked").prop("checked",!1),s.find("thead .checkbox").prop("checked",!1),l.hide(),u.fadeIn(300)})})["catch"](function(){o["default"].alert("批量操作发生错误，部分或全部信息未成功标记~").then(function(){a.forEach(function(e){var t=$('table tbody tr[data-id="'+e+'"]');t.find(".message-status-label").removeClass("label-danger").addClass("label-success")}),n.forEach(function(e){$('table tbody tr[data-id="'+e+'"]').addClass("error")}),t.find(".checkbox:checked").prop("checked",!1),s.find("thead .checkbox").prop("checked",!1),l.hide(),u.fadeIn(300)})})}),h.find("#btn_message_delete").on("click",function(){s.find("tbody tr").removeClass("error"),o["default"].confirm("确定要删除选定消息吗？").then(function(){var e=[],t=s.find("tbody .checkbox:checked").parents("tr");t.each(function(){e.push($(this).data("id"))});var n=[],a=[],c=e.map(function(e){return new Promise(function(t,c){f["default"]["delete"](e).then(function(){a.push(e),t()})["catch"](function(){n.push(e),c()})})});Promise.all(c).then(function(){o["default"].alert("批量删除成功~").then(function(){setTimeout(function(){location.reload(),t.remove(),0===s.find("tbody tr").length&&($('<div class="well bg-light m-t-lg text-center">暂无数据~</div>').appendTo(s.parent()),s.remove())},300),l.hide(),u.fadeIn(300)})})["catch"](function(){o["default"].alert("批量操作发生错误，部分或全部信息未成功删除~").then(function(){a.forEach(function(e){var t=$('table tbody tr[data-id="'+e+'"]');setTimeout(function(){t.remove(),0===s.find("tbody tr").length?($('<div class="well bg-light m-t-lg text-center">暂无数据~</div>').appendTo(s.parent()),s.remove()):(s.find("tbody .checkbox:checked").prop("checked",!1),s.find("thead .checkbox").prop("checked",!1))},300),l.hide(),u.fadeIn(300)}),n.forEach(function(e){s.find('tbody tr[data-id="'+e+'"]').addClass("error")})})})})})},352:function(e,t){}});